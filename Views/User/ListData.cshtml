@model IEnumerable<ProjectTest1.ViewModels.UserViewModel>

@{
    bool isRecoveryMode = ViewBag.Check != null && !(bool)ViewBag.Check;
}

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">
            <i class="bi bi-people-fill text-primary me-2"></i>
            @if (isRecoveryMode)
            {
                <text>Danh sách người dùng đã xóa</text>
            }
            else
            {
                <text>Danh sách người dùng</text>
            }
        </h5>

        @if (isRecoveryMode)
        {
            <a href="javascript:void(0)" onclick="user.loadData(1, true)" class="btn btn-sm btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i>Quay lại danh sách chính
            </a>
        }
    </div>
@if (Model != null && Model.Any())
{
    <div class="table-responsive shadow-sm rounded-3">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th style="width: 4%;">#</th>
                    <th>Người dùng</th>
                    <th>Email</th>
                    <th>Số điện thoại</th>
                    <th>Địa chỉ</th>
                    <th>Trạng thái</th>
                    <th>Vai trò</th>
                    <th>Ngày tạo</th>
                    <th class="text-center" style="width: 15%;">Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var index = 1;
                }
                @foreach (var user in Model)
                {
                    <tr>
                        <td>@index</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="@(user.AvatarUrl ?? "/images/default-avatar.png")"
                                     alt="Avatar"
                                     class="rounded-circle me-2"
                                     width="40" height="40"
                                     style="object-fit: cover;">
                                <div>
                                    <strong>@user.FullName</strong><br />
                                    <small class="text-muted">@user.Email</small>
                                </div>
                            </div>
                        </td>
                        <td>@user.Email</td>
                        <td>@user.Phone</td>
                        <td>@(string.IsNullOrEmpty(user.Address) ? "-" : user.Address)</td>
                        <td>
                            <a href="javascript:void(0)"
                               onclick="user.changeStatus('@user.UserId')"
                               class="badge @(user.IsActive ? "bg-success" : "bg-danger")"
                               title="Bấm để thay đổi trạng thái">
                                @(user.IsActive ? "Hoạt động" : "Vô hiệu")
                            </a>
                        </td>

                        <td>
                            @if (user.Role == "Admin")
                            {
                                <span class="badge bg-primary">Admin</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">User</span>
                            }
                        </td>
                        <td>@user.CreatedAt.ToString("dd/MM/yyyy")</td>
                        <td class="text-center">
                            <a class="btn btn-sm btn-outline-info me-1" onclick="user.openDetailModal('@user.UserId')"
                               data-bs-toggle="tooltip" title="Xem chi tiết">
                                <i class="bi bi-eye"></i>
                            </a>

                            @if (isRecoveryMode)
                            {
                                <!-- Nút phục hồi -->
                                <button class="btn btn-sm btn-outline-success me-1"
                                        onclick="user.restoreUser('@user.UserId')"
                                        data-bs-toggle="tooltip" title="Phục hồi tài khoản">
                                    <i class="bi bi-arrow-counterclockwise"></i>
                                </button>

                                <!-- Nút xóa vĩnh viễn -->
                                <button class="btn btn-sm btn-outline-danger"
                                        onclick="user.hardDelete('@user.UserId')"
                                        data-bs-toggle="tooltip" title="Xóa vĩnh viễn">
                                    <i class="bi bi-x-octagon-fill"></i>
                                </button>
                            }
                            else
                            {
                                <!-- Nút xóa mềm -->
                                <button class="btn btn-sm btn-outline-danger"
                                        onclick="user.deleteSoft('@user.UserId')"
                                        data-bs-toggle="tooltip" title="Xóa mềm">
                                    <i class="bi bi-trash"></i>
                                </button>
                            }

                        </td>
                    </tr>
                    index++;
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="text-center p-5 text-muted border rounded-3 bg-light">
        <i class="bi bi-person-x display-6 d-block mb-3"></i>
        @if (isRecoveryMode)
        {
            <text>Không có người dùng nào đã xóa phù hợp với tiêu chí tìm kiếm.</text>
        }
        else
        {
            <text>Không có người dùng nào phù hợp với tiêu chí tìm kiếm.</text>
        }
    </div>
}
<div class="d-flex justify-content-between align-items-center mt-3">
    <div>
        Tổng số bản ghi: <strong>@ViewBag.Total</strong>
    </div>
    <div id="pagination" data-total-pages="@ViewBag.totalPage">
        <ul id="paging-ul" class="pagination pagination-sm"></ul>
    </div>

</div>