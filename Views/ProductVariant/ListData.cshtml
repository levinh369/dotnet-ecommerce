@model List<ProjectTest1.ViewModels.ProductVariantViewModel>

<div class="table-responsive">
    <table class="table align-middle table-bordered" id="variantsTable">
        <thead class="table-light">
            <tr>
                <th style="width: 60px;">ID</th>
                <th style="width: 200px;">Màu</th>
                <th style="width: 100px;">Size</th>
                <th style="width: 120px;">Giá (VND)</th>
                <th style="width: 100px;">Tồn kho</th>
                <th style="width: 180px;">Hành động</th>
            </tr>
        </thead>
        <tbody id="variantsBody">
            
            @foreach (var group in Model.GroupBy(v => new { v.ColorId, v.ColorName, v.ImageUrl }))
            {
                <!-- Nhóm theo Màu -->
                <tr class="table-secondary">
                    <td colspan="6">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <!-- Ảnh to hơn (90x90) -->
                                <div style="width:90px; height:90px; overflow:hidden; border-radius:12px; background:#f5f5f5; margin-right:15px; border:1px solid #ddd;">
                                    <img src="@(!string.IsNullOrEmpty(group.Key.ImageUrl) ? group.Key.ImageUrl : "/images/placeholder.png")"
                                         alt="@group.Key.ColorName"
                                         style="width:100%; height:100%; object-fit:cover;" />
                                </div>
                                <strong class="fs-5 text-dark">@group.Key.ColorName</strong>
                            </div>

                            <!-- Nút Upload ảnh cho mỗi màu -->
                            <form class="uploadImageForm" enctype="multipart/form-data" class="d-flex align-items-center gap-2">
                                <input type="hidden" name="ColorId" value="@group.Key.ColorId" />
                                <input type="hidden" name="ProductId" value="@group.First().ProductId" />
                                <input type="file" name="ImageFile" accept="image/*" class="form-control form-control-sm" style="width:200px;" />
                                <button type="submit" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-upload"></i> Tải ảnh lên
                                </button>
                            </form>

                        </div>
                    </td>
                </tr>

                <!-- Danh sách variant theo size -->
                @foreach (var variant in group)
                {
                    <tr data-color="@variant.ColorName" data-size="@variant.SizeName">
                        <td class="fw-medium">@variant.ProductVariantId</td>
                        <td></td> <!-- để trống, màu đã hiển thị trên dòng trên -->
                        <td><span class="badge bg-secondary">@variant.SizeName</span></td>
                        <td class="text-muted fw-medium">@((variant.Price ?? 0).ToString("N0"))</td>
                        <td>
                            @if (variant.StockQuantity > 0)
                            {
                                <span class="badge bg-success">@variant.StockQuantity</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">Hết hàng</span>
                            }
                        </td>
                        <td>
                            <button class="btn btn-outline-primary btn-sm me-1"
                                    onclick="productVariant.edit(@variant.ProductVariantId)"
                                    title="Sửa">
                                <i class="bi bi-pencil-square"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm"
                                    onclick="deleteVariant(@variant.ProductVariantId)"
                                    title="Xóa">
                                <i class="bi bi-trash3"></i>
                            </button>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>

    <!-- Loading -->
    <div id="globalLoading" class="text-center mb-3"
         style="display: none; position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); z-index: 9999;">
        <div class="spinner-border text-primary" role="status"></div>
        <div><span>Đang tải dữ liệu...</span></div>
    </div>

    <!-- Footer -->
    <div class="d-flex justify-content-between align-items-center mt-3">
        <div>
            Tổng số bản ghi: <strong>@ViewBag.Total</strong>
        </div>
        <div id="pagination" data-total-pages="@ViewBag.totalPage">
            <ul id="paging-ul" class="pagination pagination-sm mb-0"></ul>
        </div>
    </div>
</div>

<!-- CSS nhỏ gọn -->
<style>
    #variantsTable img {
        transition: all 0.25s ease-in-out;
        cursor: pointer;
    }

        #variantsTable img:hover {
            transform: scale(1.08);
            box-shadow: 0 0 8px rgba(0,0,0,0.25);
        }

    .table-secondary {
        background-color: #f8f9fa !important;
    }

    .badge {
        font-size: 0.85rem;
    }
</style>
