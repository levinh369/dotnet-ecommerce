@model IEnumerable<ProjectTest1.ViewModels.ChatUserViewModel>

<style>
    .modal-right {
        display: block;
        pointer-events: none;
    }

        .modal-right .modal-dialog {
            margin: 0;
            position: absolute;
            top: 50px; /* cách top một chút cho thoáng */
            right: 20px; /* dính sát icon chat ở góc phải */
            transform: none;
            pointer-events: auto;
            max-width: 400px;
            width: 100%;
        }

        .modal-right .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }
</style>

<div class="modal fade modal-right" id="chatModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content shadow">
            <div class="modal-header">
                <h5 class="modal-title">Đoạn chat</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                @if (Model == null || !Model.Any())
                {
                    <p class="text-muted">Không có đoạn chat nào</p>
                }
                else
                {
                    <ul class="list-group">
                        @foreach (var chat in Model)
                        {
                            <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                                onclick="chat.toggleChat(@chat.ConversationId, '@chat.BuyerName', true)">

                                <div class="d-flex align-items-center">
                                    <img src="@(string.IsNullOrEmpty(chat.AvatarUrl) ? "/images/default-avatar.png" : chat.AvatarUrl)"
                                         alt="@chat.BuyerName"
                                         class="rounded-circle me-2"
                                         width="40"
                                         height="40"
                                         style="object-fit: cover; border: 1px solid #ddd;" />

                                    <div>
                                        <strong>@chat.BuyerName</strong><br />
                                        <small class="text-muted @(chat.isRead ? "" : "fw-bold")">
                                            @chat.LastMessage • @chat.SentTime.ToString("HH:mm dd/MM")
                                        </small>
                                    </div>
                                </div>

                                @if (!chat.isRead)
                                {
                                    <span id="dot-@chat.ConversationId"
                                          class="dot bg-primary rounded-circle"
                                          style="display:inline-block;width:10px;height:10px;"></span>
                                }
                            </li>
                        }
                    </ul>

                }
            </div>
        </div>
    </div>
</div>