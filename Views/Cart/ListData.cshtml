@model List<ProjectTest1.ViewModels.CartItemViewModel>
<div class="container my-4">
    <!-- container để căn giữa và có padding tự nhiên -->
    <h2 class="mb-4">Giỏ Hàng</h2>
        <table class="table table-bordered table-hover align-middle">
            <thead class="table-light">
                <tr class="text-center">
                    <th>Ảnh</th>
                    <th class="text-start">Sản phẩm</th>
                    <th>Phân loại</th>
                    <th>Giá</th>
                    <th>Số lượng</th>
                    <th>Thành tiền</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr data-id="@item.ProductVariantId" data-price="@item.UnitPrice">
                        <td style="width:100px;">
                            <img src="@item.ImageUrl" alt="@item.ProductName" class="img-fluid rounded" />
                        </td>
                        <td class="text-start ps-3">@item.ProductName</td>
                        <td class="text-center">
                            SIZE @item.SizeName@if(!string.IsNullOrEmpty(item.ColorName)){
                            <span>, @item.ColorName</span>
                        }
                    </td>
                <td class="text-center pe-3">
                    @((item.UnitPrice ?? 0).ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN")))
                </td>

                    <td style="width:130px;" class="text-center">
                    <div class="input-group input-group-sm">
                        <button type="button" onclick="cart.changeQuantity('-', @item.ProductVariantId)" class="btn btn-outline-secondary btn-decrease">-</button>
                        <input type="number"
                               class="form-control text-center quantity-input"
                               value="@item.Quantity"
                               min="1"
                               readonly />
                        <button type="button" onclick="cart.changeQuantity('+', @item.ProductVariantId)" class="btn btn-outline-secondary btn-increase">+</button>
                    </div>

                    </td>
                    <td class="total-price text-center pe-3">
                        @( (item.UnitPrice * item.Quantity??0).ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN")) )
                    </td>
                    <td class="text-center"> 
                    <button onclick="cart.delete(@item.ProductVariantId)" class="btn btn-sm btn-danger">Xóa</button>

                    </td>
                </tr>
                 }
            </tbody>
        </table>
    <div class="d-flex justify-content-between align-items-center mt-3">
        <div>
            Tổng số bản ghi: <strong>@ViewBag.Total</strong>
        </div>
        <div id="pagination" data-total-pages="@ViewBag.totalPage">
            <ul id="paging-ul" class="pagination pagination-sm"></ul>
        </div>

    </div>
    <div class="d-flex mt-4">
        <a href="@Url.Action("Index", "Products")" class="btn btn-secondary me-auto">Tiếp tục mua sắm</a>
        <a href="/Cart/Checkout" class="btn btn-success btn-lg">Thanh toán</a>
    </div>
</div>

@section Scripts {
    <script>
        document.querySelectorAll('tr[data-id]').forEach(row => {
            const input = row.querySelector('.quantity-input');
            const totalCell = row.querySelector('.total-price');
            const price = parseFloat(row.dataset.price);

            // tăng
            row.querySelector('.btn-increase').addEventListener('click', () => {
                input.value = parseInt(input.value) + 1;
                totalCell.textContent = (price * input.value).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
            });

            // giảm
            row.querySelector('.btn-decrease').addEventListener('click', () => {
                if (parseInt(input.value) > 1) {
                    input.value = parseInt(input.value) - 1;
                    totalCell.textContent = (price * input.value).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                }
            });

            // cập nhật khi gõ trực tiếp
            input.addEventListener('input', () => {
                if (input.value < 1) input.value = 1;
                totalCell.textContent = (price * input.value).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
            });
        });
    </script>
}